<?xml version="1.0" encoding="UTF-8"?>
<mets:mets xmlns:mets="http://www.loc.gov/METS/"
           xmlns:xlink="http://www.w3.org/1999/xlink"
           xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
           xmlns:csip="https://DILCIS.eu/XML/METS/CSIPExtensionMETS"
           xsi:schemaLocation="http://www.loc.gov/METS/ http://www.loc.gov/standards/mets/mets.xsd"
           OBJID="{{ hoso.objid }}"
           LABEL="{{ hoso.effective_title | escape_xml }}"
           TYPE="Mixed"
           PROFILE="https://eark-project.com/E-ARK-CSIP-1.2">

  <!-- METS Header -->
  <mets:metsHdr CREATEDATE="{{ created_time | format_date('%Y-%m-%dT%H:%M:%S+07:00') }}"
                LASTMODDATE="{{ created_time | format_date('%Y-%m-%dT%H:%M:%S+07:00') }}">
    <csip:OAISPACKAGETYPE>AIP</csip:OAISPACKAGETYPE>
    <mets:agent ROLE="{{ config.software_agent_role }}" TYPE="{{ config.software_agent_type }}" OTHERTYPE="{{ config.software_agent_othertype }}">
      <mets:name>{{ config.software_agent_name }}</mets:name>
      <mets:note csip:NOTETYPE="SOFTWARE VERSION">{{ config.software_agent_version }}</mets:note>
    </mets:agent>
    <mets:agent ROLE="EDITOR" TYPE="ORGANIZATION">
      <mets:name>{{ config.organization_name | escape_xml }}</mets:name>
      <mets:note csip:NOTETYPE="IDENTIFICATIONCODE">{{ config.agency_code }}</mets:note>
      {% if config.organization_email %}
      <mets:note>Contact: {{ config.organization_email }}</mets:note>
      {% endif %}
    </mets:agent>
    <mets:agent ROLE="ARCHIVIST" TYPE="ORGANIZATION">
      <mets:name>{{ config.archivist_name | escape_xml }}</mets:name>
      <mets:note csip:NOTETYPE="IDENTIFICATIONCODE">{{ config.archivist_code }}</mets:note>
    </mets:agent>
  </mets:metsHdr>
  
  <!-- Descriptive Metadata Section - Using mdRef for external references -->
  <mets:dmdSec ID="uuid-{{ hoso.main_dmd_uuid | upper }}" CREATED="{{ created_time }}">
    <mets:mdRef ID="uuid-{{ hoso.main_dmd_ref_uuid | upper }}"
                LOCTYPE="URL" 
                MDTYPE="OTHER"
                OTHERMDTYPE="EAD"
                MDTYPEVERSION="1.0"
                MIMETYPE="text/xml"
                SIZE="PLACEHOLDER_EAD_SIZE"
                CHECKSUMTYPE="SHA-256"
                CHECKSUM="PLACEHOLDER_EAD_CHECKSUM"
                CREATED="{{ created_time }}"
                xlink:type="simple"
                xlink:href="metadata/descriptive/EAD.xml"/>
  </mets:dmdSec>
  
  <!-- Administrative Metadata -->
  <mets:amdSec ID="uuid-{{ hoso.main_amd_uuid | upper }}">
    <mets:digiprovMD ID="uuid-{{ hoso.main_digiprov_uuid | upper }}" STATUS="CURRENT">
      <mets:mdRef ID="uuid-{{ hoso.main_premis_ref_uuid | upper }}"
                  LOCTYPE="URL" 
                  MDTYPE="PREMIS" 
                  MIMETYPE="text/xml"
                  SIZE="PLACEHOLDER_PREMIS_SIZE"
                  CHECKSUMTYPE="SHA-256"
                  CHECKSUM="PLACEHOLDER_PREMIS_CHECKSUM"
                  CREATED="{{ created_time }}"
                  xlink:type="simple"
                  xlink:href="metadata/preservation/PREMIS.xml"/>
    </mets:digiprovMD>
  </mets:amdSec>

  <!-- File Section -->
  <mets:fileSec ID="uuid-{{ hoso.main_filesec_uuid | upper }}">
    <!-- Representation Files -->
    <mets:fileGrp ID="uuid-{{ hoso.main_repr_group_uuid | upper }}" USE="Representations/rep1">
      <mets:file ID="ID-{{ hoso.main_repr_file_uuid | upper }}" MIMETYPE="application/xml" CREATED="{{ created_time }}" CHECKSUMTYPE="SHA-256" CHECKSUM="PLACEHOLDER_REP_CHECKSUM">
        <mets:FLocat LOCTYPE="URL" xlink:href="representations/rep1/METS.xml" xlink:type="simple"/>
      </mets:file>
    </mets:fileGrp>
    
    <!-- Schema Files -->
    <mets:fileGrp ID="uuid-{{ hoso.main_schemas_group_uuid | upper }}" USE="Schemas">
      <mets:file ID="ID-{{ hoso.main_mets_xsd_uuid | upper }}" MIMETYPE="application/octet-stream" CREATED="{{ created_time }}" CHECKSUMTYPE="SHA-256" CHECKSUM="PLACEHOLDER_SCHEMA_METS_CHECKSUM">
        <mets:FLocat LOCTYPE="URL" xlink:href="schemas/mets.xsd" xlink:type="simple"/>
      </mets:file>
      <mets:file ID="ID-{{ hoso.main_ead_xsd_uuid | upper }}" MIMETYPE="application/octet-stream" CREATED="{{ created_time }}" CHECKSUMTYPE="SHA-256" CHECKSUM="PLACEHOLDER_SCHEMA_EAD_CHECKSUM">
        <mets:FLocat LOCTYPE="URL" xlink:href="schemas/ead.xsd" xlink:type="simple"/>
      </mets:file>
      <mets:file ID="ID-{{ hoso.main_premis_xsd_uuid | upper }}" MIMETYPE="application/octet-stream" CREATED="{{ created_time }}" CHECKSUMTYPE="SHA-256" CHECKSUM="PLACEHOLDER_SCHEMA_PREMIS_CHECKSUM">
        <mets:FLocat LOCTYPE="URL" xlink:href="schemas/premis.xsd" xlink:type="simple"/>
      </mets:file>
    </mets:fileGrp>
  </mets:fileSec>

  <!-- Structure Map - Package Level -->
  <mets:structMap ID="uuid-{{ hoso.main_structmap_uuid | upper }}" LABEL="CSIP" TYPE="PHYSICAL">
    <mets:div ID="uuid-{{ hoso.main_div_uuid | upper }}" LABEL="uuid-{{ hoso.main_dmd_uuid | upper }}">
      
      <!-- Metadata -->
      <mets:div ID="uuid-{{ hoso.main_metadata_div_uuid | upper }}" LABEL="Metadata" DMDID="uuid-{{ hoso.main_dmd_uuid | upper }}" ADMID="uuid-{{ hoso.main_amd_uuid | upper }}">
      </mets:div>
      
      <!-- Schemas -->
      <mets:div ID="uuid-{{ hoso.main_schemas_div_uuid | upper }}" LABEL="Schemas">
        <mets:fptr FILEID="uuid-{{ hoso.main_schemas_group_uuid | upper }}"/>
      </mets:div>
      
      <!-- Representations -->
      <mets:div ID="uuid-{{ hoso.main_repr_div_uuid | upper }}" LABEL="Representations/rep1">
        <mets:mptr LOCTYPE="URL" xlink:href="representations/rep1/METS.xml" xlink:type="simple" xlink:title="uuid-{{ hoso.main_repr_file_uuid | upper }}"/>
      </mets:div>
      
    </mets:div>
  </mets:structMap>

</mets:mets>
